<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8">
    <link href="css/mystyle.css" rel="stylesheet"/>
    <meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
</head>
<body>
    <div id="order-list">
        <div class="card">
            <div class="card-title">
                <div class="product"><span class="name">iphone6</span> × <span class="total-quantity">6</span> <i class="fa fa-caret-right"></i></div>
                <div class="all-status"><i class="fa fa-square-o"></i></div>
            </div>
            <div class="table">
                <div class="t-row t-row-over-1 t-row-header">
                    <div class="t-col t-col-2">卖家</div>
                    <div class="t-col t-col-2">数量</div>
                    <!--<div class="t-col t-col-2">客户</div>-->
                    <div class="t-col t-col-2">备注</div>
                    <div class="t-col t-col-2">进价</div>
                    <div class="t-col t-col-1">状态</div>
                    <div class="t-col t-col-1 extra">操作</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-2">子弹</div>
                    <div class="t-col t-col-2 quantity" contenteditable="true">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <span class="num">2</span>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">3人</div>-->
                    <div class="t-col t-col-2" contenteditable="true" style="overflow-y: hidden;"></div>
                    <div class="t-col t-col-2 input-div"><input type="text" placeholder=""/></div>
                    <div class="t-col t-col-1 buy-status"><i class="fa fa-square-o"></i></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-2">老孙</div>
                    <div class="t-col t-col-2 quantity" contenteditable="true">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <span class="num">2</span>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">孙大个</div>-->
                    <div class="t-col t-col-2" contenteditable="true"></div>
                    <div class="t-col t-col-2" contenteditable="true">100</div>
                    <div class="t-col t-col-1 buy-status"><i class="fa fa-square-o"></i></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">
                <div class="product"><span class="name">奶粉+油条</span> × <span class="total-quantity">16</span> <i class="fa fa-caret-right"></i></div>
                <div class="all-status"><i class="fa fa-square-o"></i></div>
            </div>
            <div class="table">
                <div class="t-row t-row-over-1 t-row-header">
                    <div class="t-col t-col-2">卖家</div>
                    <div class="t-col t-col-2">数量</div>
                    <!--<div class="t-col t-col-2">客户</div>-->
                    <div class="t-col t-col-2">备注</div>
                    <div class="t-col t-col-2">进价</div>
                    <div class="t-col t-col-1">状态</div>
                    <div class="t-col t-col-1 extra">操作</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-2">子弹</div>
                    <div class="t-col t-col-2 quantity" contenteditable="true">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <span class="num">2</span>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">3人</div>-->
                    <div class="t-col t-col-2" contenteditable="true" style="overflow-y: hidden;"></div>
                    <div class="t-col t-col-2 input-div"><input type="text" placeholder=""/></div>
                    <div class="t-col t-col-1 buy-status"><i class="fa fa-square-o"></i></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-2">老孙</div>
                    <div class="t-col t-col-2 quantity" contenteditable="true">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <span class="num">2</span>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">孙大个</div>-->
                    <div class="t-col t-col-2" contenteditable="true"></div>
                    <div class="t-col t-col-2" contenteditable="true">100</div>
                    <div class="t-col t-col-1 buy-status"><i class="fa fa-square-o"></i></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">
                <div class="product"><span class="name">枪支弹药</span> × <span class="total-quantity">16000</span> <i class="fa fa-caret-right"></i></div>
                <div class="all-status"><i class="fa fa-square-o"></i></div>
            </div>
            <div class="table">
                <div class="t-row t-row-over-1 t-row-header">
                    <div class="t-col t-col-2">卖家</div>
                    <div class="t-col t-col-2">数量</div>
                    <!--<div class="t-col t-col-2">客户</div>-->
                    <div class="t-col t-col-2">备注</div>
                    <div class="t-col t-col-2">进价</div>
                    <div class="t-col t-col-1">状态</div>
                    <div class="t-col t-col-1 extra">操作</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-2">子弹</div>
                    <div class="t-col t-col-2 quantity" contenteditable="true">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <span class="num">2</span>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">3人</div>-->
                    <div class="t-col t-col-2" contenteditable="true" style="overflow-y: hidden;"></div>
                    <div class="t-col t-col-2 input-div"><input type="text" placeholder=""/></div>
                    <div class="t-col t-col-1 buy-status"><i class="fa fa-square-o"></i></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-2">老孙</div>
                    <div class="t-col t-col-2 quantity" contenteditable="true">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <span class="num">2</span>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">孙大个</div>-->
                    <div class="t-col t-col-2" contenteditable="true"></div>
                    <div class="t-col t-col-2" contenteditable="true">100</div>
                    <div class="t-col t-col-1 buy-status"><i class="fa fa-square-o"></i></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-2">阿杰</div>
                    <div class="t-col t-col-2 quantity" contenteditable="true">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <span class="num">2</span>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">孙大个</div>-->
                    <div class="t-col t-col-2" contenteditable="true"></div>
                    <div class="t-col t-col-2" contenteditable="true">100</div>
                    <div class="t-col t-col-1 buy-status"><i class="fa fa-square-o"></i></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
            </div>
        </div>
    </div>
    <div id="pay-list">
        <div class="card">
            <div class="card-title">
                <div class="product"><span class="name">子弹</span> 总计: <span class="total-quantity">16000</span> <i class="fa fa-caret-right"></i></div>
                <div class="all-status"><span>已付：</span><i class="fa fa-square-o"></i></div>
            </div>
            <div class="table">
                <div class="t-row t-row-over-1 t-row-header">
                    <div class="t-col t-col-3">品名</div>
                    <div class="t-col t-col-2">数量</div>
                    <!--<div class="t-col t-col-2">客户</div>-->

                    <div class="t-col t-col-2">进价</div>
                    <div class="t-col t-col-2">售价</div>
                    <div class="t-col t-col-1 extra">操作</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-3">奶粉油条</div>
                    <div class="t-col t-col-2 quantity">
                        <div class="sub"><i class="fa fa-caret-left"></i></div>
                        <div class="num" contenteditable="true">2</div>
                        <div class="add"><i class="fa fa-caret-right"></i></div>
                    </div>
                    <!--<div class="t-col t-col-2">3人</div>-->
                    <div class="t-col t-col-2 input-div"><input type="text" placeholder=""/></div>
                    <div class="t-col t-col-2 input-div"><input type="text" class="unitPrice" placeholder=""/></div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-9">
                        <span>编辑邮费：</span><input type="text" class="mailpay" placeholder="0"><span class="unit">元</span>
                        <i class="fa fa-square-o mailFree"></i><span>包邮</span>
                    </div>
                </div>
            </div>
            <div class="extra-row">
                <div class="t-col-5 remark-col">
                    备注：<span>袁子俊</span>
                </div>
                <div class="t-col-5 getpay">
                    <input type="button" value="向买家收款"/>
                </div>
            </div>
        </div>

    </div>
    <div id="bill-list">
        <div class="position t-col-10">
            <div class="t-col-2">
                <input type="text" id="date1" placeholder="开始日期" value="" class="date"/>
            </div>
            <div class="t-col-2">
                <input type="text" id="date2" placeholder="结束日期" value="" class="date"/>
            </div>
            <div class="t-col-3">
                <input type="text" id="nickname" placeholder="根据买家搜索" value="" class="search-input"/>
            </div>
            <div class="t-col-2">
                <input type="button" id="search" value="GO"/>
            </div>
        </div>

        <div class="card">
            <div class="table">
                <div class="t-row t-row-over-1 t-row-header">
                    <div class="t-col t-col-3">品名</div>
                    <div class="t-col t-col-2">数量</div>
                    <!--<div class="t-col t-col-2">客户</div>-->

                    <div class="t-col t-col-2">进价</div>
                    <div class="t-col t-col-2">售价</div>
                    <div class="t-col t-col-1 extra">操作</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-3">奶粉油条</div>
                    <div class="t-col t-col-2 quantity">
                        <div class="num">2</div>
                    </div>
                    <!--<div class="t-col t-col-2">3人</div>-->
                    <div class="t-col t-col-2">111</div>
                    <div class="t-col t-col-2">123</div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-3">小熊饼干</div>
                    <div class="t-col t-col-2 quantity">
                        <div class="num">2</div>
                    </div>
                    <!--<div class="t-col t-col-2">3人</div>-->
                    <div class="t-col t-col-2">222</div>
                    <div class="t-col t-col-2">268</div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-3">猫屎咖啡</div>
                    <div class="t-col t-col-2 quantity">
                        <div class="num">2</div>
                    </div>
                    <!--<div class="t-col t-col-2">3人</div>-->
                    <div class="t-col t-col-2">1200</div>
                    <div class="t-col t-col-2">1500</div>
                    <div class="t-col t-col-1 extra">删除</div>
                </div>
                <div class="t-row t-row-over-1">
                    <div class="t-col t-col-9">
                        <span>邮费成本：</span>300<span class="unit">元</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="bill-sum t-col-10">
            <div id="sum_cost" class="t-col-5">
                总成本：<span>1000</span>元
            </div>
            <div id="sum_earn" class="t-col-5">
                总盈利：<span>200</span>元
            </div>
        </div>

    </div>
<div id="switchList" style="position: fixed;bottom: 100px;">
    <input id="to_order" type="button" value="账单列表">
    <input id="to_pay" type="button" value="付款列表">
    <input id="to_bill" type="button" value="总账单列表">
    <input id="add" type="button" value="添加测试记录"/>
</div>
</body>
<script src="javascripts/jquery.js"></script>
<script src="touchUtil.js"></script>
<script>
    $("#add").touch('click',function(){
        var record = '<div class="t-row t-row-over-1"><div class="t-col t-col-3">哇哈哈哈</div>' +
                '<div class="t-col t-col-2 quantity">' +
                '<div class="sub"><i class="fa fa-caret-left"></i></div>' +
                '<div class="num" contenteditable="true">2</div>' +
                '<div class="add"><i class="fa fa-caret-right"></i></div></div>' +
                '<div class="t-col t-col-2 input-div"><input type="text" placeholder=""/></div>' +
                '<div class="t-col t-col-2 input-div"><input type="text" class="unitPrice" placeholder=""/></div>' +
                '<div class="t-col t-col-1 extra">删除</div></div>';
        $("#pay-list .table .t-row-header").after(record)
    });
    $('#to_order,#to_pay,#to_bill').touch("click",function(event){
        var $this = event.$this;
        if($this.attr("id") == 'to_order'){
            $("#bill-list").css("display",'none');
            $("#pay-list").css("display",'none');
            $("#order-list").css("display",'block');
        }else if($this.attr("id") == 'to_pay'){
            $("#pay-list").css("display",'block');
            $("#order-list").css("display",'none');
            $("#bill-list").css("display",'none');
        }else{
            $("#bill-list").css("display",'block');
            $("#order-list").css("display",'none');
            $("#pay-list").css("display",'none');
        }
    });
//    $(".t-row:not(.t-row-header)").touch("swipeleft",function(event){
////        event.stopPropagation();
//        alert("删除当前列");
//        var $this = event.$this;
////        $this.css({
////            marginLeft:- getMarginLeft(event.$this)
////        }).addClass('operateObj');
//    });

    $(".buy-status").touch('click',function(event){
        var $this = event.$this,
                $checkbox,
                $card = $this.parents('.card');
        if(($checkbox = $this.find(".fa-square-o")).length > 0){
            $checkbox.removeClass("fa-square-o").addClass("fa-check-square");
            var checkCount = 0;
            $this.parents(".t-row").siblings(".t-row").find(".buy-status .fa-check-square").each(function(){
                var $ckbox = $(this);
                checkCount++;
            });
            if(checkCount == $card.find(".t-row:not(.t-row-header)").length - 1){
                if(confirm("确认"+$($this.parents('.card').find('span.total-quantity')).text()+"个"+$this.parents('.card').find('span.name').text()+"已经购买")){
                    $card.remove();
                }else{
                    $checkbox.addClass("fa-square-o").removeClass("fa-check-square");
                }
            }
        }else{
            $this.find(".fa-check-square").removeClass('fa-check-square').addClass('fa-square-o');
        }
    });


    $(document).touch("click",function(event){
        $(".operateObj").css("margin-left",0).removeClass('operateObj');
        var $target =$(event.target);
        if(!($target.hasClass("sub")||$target.hasClass("add")||$target.hasClass("num") || $target.hasClass(".quantity"))){
            $('.add,.sub').css("display",'none');
        }
    });
    function getMarginLeft($row){
        var ml = 0;
        $row.find('.extra').each(function(){
            ml += $(this).width();
        });
        return ml;
    }
    $(".card .product").touch("click",function(event){
        event.$this.parent().siblings('.table').toggle(500);
        var $this = event.$this,
                $caret;
        if(($caret = $this.find(".fa-caret-right")).length > 0){
            $caret.removeClass("fa-caret-right").addClass("fa-caret-down");
            $this.parents(".card").siblings(".card").each(function(){
                var $c = $(this),$table;
                if(($table = $c.find(".table")).css("display") != 'none'){
                    $table.toggle(500);
                    $c.find(".product .fa-caret-down").addClass("fa-caret-right").removeClass("fa-caret-down");
                }
            });
        }else if(($caret = $this.find(".fa-caret-down")).length > 0){
            $caret.addClass("fa-caret-right").removeClass("fa-caret-down");
        }
    });
    $(".all-status").touch("click",function(event){
        var $this = event.$this;
        if($this.parents("#order-list").length > 0){
            if(confirm("确认"+$($this.parents('.card').find('span.total-quantity')).text()+"个"+$this.parents('.card').find('span.name').text()+"已经购买?")){
                $this.parents(".card").remove();
            }
        }else if($this.parents("#pay-list").length > 0){
            if(confirm("确认"+$this.parents('.card').find('span.name').text()+"已经付款?")){
                $this.parents(".card").remove();
            }
        }

    });
    $(".quantity .sub,.quantity .add").touch("click",function(event){
        var $this = event.$this;
        var $quantity = $this.siblings(".num");
        var q = Number($quantity.text());
        if($this.hasClass('sub')){
            $quantity.text(--q);
            if(q == 1){
                if(confirm("确认删除订单？")){
                    $quantity.text(--q);
                    //删除订单
                }
            }
        }else{
            $quantity.text(++q);
        }
        if($this.parents("#pay-list").length > 0){
            calcBillPay($this.parents(".card"));
        }
    },true);
    $(".quantity").touch("click",function(event){
        var $this = event.$this;
        $this.find('.add,.sub').css("display",'block');
        $this.parents(".t-row").siblings('.t-row').find(".add,.sub").css("display","none");
    },true);
//    $(".quantity").on("blur",function(){
//        $(this).find('.add,.sub').css("display",'none');
//    });
$(document).on("input",".t-col input[type='text']",function(event){
    var originV = $(this).val();
    var currentInput = originV.substring(originV.length - 1);
    originV=originV.substring(0,originV.length - 1);
    if(!(currentInput >= 0 && currentInput <= 9)){
        $(this).val(originV);
        return;
    }
}).on('blur',".t-col input[type='text']",function(){
            var $this = $(this);
            var $card = $(this).parents('.card');
            if($this.parents("#pay-list").length > 0){
                calcBillPay($card);
            }
        });

    $(".mailFree").touch("click",function(event){
        var $this = event.$this;
        if($this.hasClass("fa-square-o")){
            $this.removeClass("fa-square-o").addClass("fa-check-square");
        }else{
            $this.addClass("fa-square-o").removeClass("fa-check-square");
        }
    });
/**
 * 计算账单费用
 */
    function calcBillPay($card){
        var total = 0,
                $mailpay;
        $card.find(" .table .t-row:not(.t-row-header)").each(function(){
            var $row = $(this);
            var num = Number($row.find('.quantity .num').text()),
                    unitPrice = Number($row.find('.unitPrice').val());
            num = isNaN(num)?0:num;
            unitPrice = isNaN(unitPrice)?0:unitPrice;
            total += num * unitPrice;
            if(($mailpay = $row.find(".mailpay")).length > 0){
                total += Number($mailpay.val());
            }
        });
        $card.find(" .total-quantity").text(total);
    }
    /******总账单******/

</script>
</html>